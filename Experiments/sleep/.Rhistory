setwd("C:/Users/Zachary Palmore/GitHub/misc/Experiments/sleep")
d2021 <- readxl::read_xlsx("2021.xlsx")
d2022 <- readxl::read_xlsx("2022.xlsx")
colnames(d2022)
d2022 <- d2022[,c(1:3, 9)] # Select times related to sleep each night
d2021 <- d2021[,c(1:3, 9)] # For both data sets
colnames(d2021) <- colnames(d2022)
colnames(d2021)
df <- rbind(d2021, d2022)
sum(is.na(df))
df[which(is.na(df)),]
library(lubridate)
df$Bedtime <- lubridate::as_datetime(df$Bedtime)
df$`Wake Time` <- lubridate::as_datetime(df$`Wake Time`)
df$Timeslept <- df$`Wake Time` - df$Bedtime
dt <- lubridate::interval(start = lubridate::as_date("1900-01-01"), end = lubridate::as_date("2022-11-06"))
dt <- seq.Date(from = as.Date("1900-01-01"), to = as.Date("2022-12-31"), by = "day")
dt <- data.frame(Date = dt)
dt$Place <- seq(1, length(dt$Date), by = 1)
df$Date[match(df$Date, dt$Place, nomatch = NA)]
df$Date
df$Date[which(df$Date == "44197.0")]
# Need to join with dt reference table the df dates that match place
library(dplyr)
library(ggplot2)
df %>%
mutate(Place = as.numeric(Date)) %>%  # convert to numeric
dplyr::inner_join(dt, by = "Place") %>%  # includes all rows in x AND y
dplyr::select(-Date.x, -Place) %>%
ggplot(aes(Date.y, seq(1, length(Date.y), 1))) + geom_line()
df$True_Date <- seq(as.numeric(df[1,1]), by = 1, length.out = as.numeric(which(df$Date == "44926.0")))
df$True_Date <- as.numeric(c(seq(as.numeric(df[1,1]), by = 1, length.out = as.numeric(which(df$Date == "44926.0"))),
rep(-999, (length(df$Date) -
length(seq(as.numeric(df[1,1]), by = 1,
length.out = as.numeric(which(df$Date == "44926.0")))))
)
))
df <- df %>%
rename(Place = True_Date) %>%  # convert to numeric
dplyr::inner_join(dt, by = "Place") %>% # includes all rows in x AND y
dplyr::select(-Date.x, -Place)
View(df)
dt <- lubridate::interval(start = lubridate::as_date("1900-01-01"), end = lubridate::as_date("2022-11-06"))
dt <- seq.Date(from = as.Date("1900-01-01"), to = as.Date("2022-12-31"), by = "day")
dt <- data.frame(Date = dt)
values <- df$`Time in Bed`[which(as.numeric(df$`Time in Bed`) >= 0)]
values <- as.numeric(values)
as.numeric(df$`Time in Bed`)
min(as.numeric(df$`Time in Bed`), na.rm = T)
values <- df$`Time in Bed`[which(df$`Time in Bed` >= 0)]
max(values)
values <- df$`Time in Bed`[which(as.numeric(df$`Time in Bed`) >= 0)]
values <- as.numeric(values)
time_values <- seq(min(values), max(values), by = 0.00000001) # Thats 99,791,667 obs!
time_values = data.frame(time_values= time_values)
format(as.POSIXct(Sys.Date() + 0.8541667), "%H:%M", tz="UTC")
chron::times(0.8541667)
library(chron)
df$Date.y <- as.Date(df$Date.y)
df$`Time in Bed` <- as.numeric(df$`Time in Bed`)
df$New_TIB <- format(as.POSIXct(df$Date.y + df$`Time in Bed`), "%H:%M", tz = "UTC")
View(df)
